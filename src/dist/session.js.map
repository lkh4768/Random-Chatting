{"version":3,"sources":["../es6/session.js"],"names":["_id","Symbol","_socket","Session","socket","events","SEQ","_setEvent","eventNameKey","EVENT_NAMES","on","data","DEFAULT_EVENT","destroyed","destroy","CLOSE","ERROR","DATA","DRAIN","END","TIMEOUT","id","had_error","console","log","error","buf","module","exports"],"mappings":"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","file":"session.js","sourcesContent":["const _id = Symbol();\r\nconst _socket = Symbol();\r\nclass Session{\r\n  constructor(socket, events){\r\n    this[_id] = Session.SEQ++;\r\n    this[_socket] = socket;\r\n    this._setEvent(events);\r\n  }\r\n  _setEvent(events){\r\n    if(events) {\r\n      for (let eventNameKey in Session.EVENT_NAMES) {\r\n        if (Session.EVENT_NAMES[eventNameKey] === 'close' \r\n\t\t\t\t\t|| Session.EVENT_NAMES[eventNameKey] === 'error' \r\n\t\t\t\t\t|| Session.EVENT_NAMES[eventNameKey] === 'data') {\r\n          if (events[Session.EVENT_NAMES[eventNameKey]]) \r\n\t\t\t\t\t\tthis[_socket].on(Session.EVENT_NAMES[eventNameKey],\r\n\t\t\t\t\t\t\t(data) => {events[Session.EVENT_NAMES[eventNameKey]](this[_id], data);});\r\n          else \r\n\t\t\t\t\t\tthis[_socket].on(Session.EVENT_NAMES[eventNameKey],\r\n\t\t\t\t\t\t\t(data) => {Session.DEFAULT_EVENT[eventNameKey](this[_id], data);});\r\n        } else {\r\n          if (events[Session.EVENT_NAMES[eventNameKey]]) \r\n\t\t\t\t\t\tthis[_socket].on(Session.EVENT_NAMES[eventNameKey],\r\n\t\t\t\t\t\t\t() => {events[Session.EVENT_NAMES[eventNameKey]](this[_id]);});\r\n          else \r\n\t\t\t\t\t\tthis[_socket].on(Session.EVENT_NAMES[eventNameKey],\r\n\t\t\t\t\t\t\t() => {Session.DEFAULT_EVENT[eventNameKey](this[_id]);});\r\n        }\r\n      }\r\n    }\r\n  }\r\n  get id(){\r\n    return this[_id];\r\n  }\r\n  get socket(){\r\n    return this[_socket];\r\n  }\r\n\tclose(){\r\n\t\tif(!this[_socket].destroyed) \r\n\t\t\tthis[_socket].destroy();\r\n\t}\r\n}\r\n\r\nSession.SEQ = 1;\r\nSession.EVENT_NAMES = { \r\n\tCLOSE: 'close',\r\n\tERROR: 'error',\r\n\tDATA: 'data',\r\n\tDRAIN: 'drain',\r\n\tEND: 'end',\r\n\tTIMEOUT: 'timeout' \r\n};\r\nSession.DEFAULT_EVENT = {\r\n  CLOSE: (id, had_error)=>{ console.log(`close session(${id}), had error(${had_error})`); },\r\n  ERROR: (id, error)=>{ console.log(`error(${error}) session(${id})`); },\r\n  DATA: (id, buf)=>{ console.log(`data(${buf}) session(${id})`); },\r\n  DRAIN: (id)=>{ console.log(`drain session(${id})`); },\r\n  END: (id)=> {console.log(`end session(${id})`); },\r\n  TIMEOUT: (id)=>{ console.log(`timeout session(${id})`); }\r\n};\r\nmodule.exports = Session;\r\n"]}